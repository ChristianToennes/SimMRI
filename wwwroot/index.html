<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="shortcut icon" href="./favicon.ico">
    <title>SimMRI</title>
    <script src="./vmri.js"></script>
    <link rel="stylesheet" href="./custom.css" />
</head>

<body class="text-monospace" onload="fillDatasets()">
    <div class="main">
        <div class="top-row px-4">
            <button class="btn-primary" onclick="loadFuzzyDataSet()" value="Load Dataset" id="loadDataset">Load Dataset:
            </button>
            <select id="datasetPath" class="" onchange="changedDataset()"></select>
            <a id="datasetURL" class="nav-item cp1s1"></a>
            <div class="ms-2 spinner-border hidden" role="status" id="datasetLoading">
                <span class="visually-hidden">Loading...</span>
            </div>
            <div class="flex-fill"></div>
            <button class="btn-secondary" style="display:none" onclick="profile()" value="profile"
                id="profile">Profile</button>
            <div class="flex-fill"></div>
            <p class="h-100 mr-3 nav-item"><a class="cp1" href="https://github.com/ChristianToennes/SimMRI">Source
                    Code</a></p>
            <h1 class="cp1">SimMRI</h1>
        </div>
        <div class="content px-4 pt-2 hidden" id="content">
            <div class="row hidden" id="dataset" onwheel="scrollDataset(event)">
                <figure class="col pe-0 figure text-center">
                    <figcaption class="figure-caption">Proton density</figcaption>
                    <canvas class="figure-img img-fluid rounded" id="imgPD"></canvas>
                </figure>
                <figure class="col ps-0 pe-0 figure text-center">
                    <figcaption class="figure-caption">T1 time</figcaption>
                    <canvas class="figure-img img-fluid rounded" id="imgT1"></canvas>
                </figure>
                <figure class="col ps-0 figure text-center">
                    <figcaption class="figure-caption">T2 time</figcaption>
                    <canvas class="figure-img img-fluid rounded" id="imgT2"></canvas>
                </figure>
                <figure class="col ps-0 figure text-center">
                    <figcaption class="figure-caption">T2* time</figcaption>
                    <canvas class="figure-img img-fluid rounded" id="imgT2s"></canvas>
                </figure>
            </div>
            <div class="row mx-1 hidden" id="dataset_slider">
                <div class="col-auto">
                    <label class="mb-0 py-1 align-self-center" for="slice">Slice:</label>
                </div>
                <div class="col">
                    <input type="range" class="ps-0 pe-0 align-self-center form-control form-control-range" min="0"
                        max="zdim" name="slice" id="slice" value="100" onchange="displayDataSet();" />
                </div>
            </div>

            <div class="row mt-2" onkeydown="sequenceParametersKeyDown(event)">
                <div class="accordion">
                    <div class="accordion-item">
                        <div class="accordion-header" id="acc-general-head" onclick="toggleAccordion('general')">
                            <button class="accordion-button" type="button">General Parameters</button>
                        </div>
                        <div id="acc-general-content" class="accordion-collapse collapse show">
                            <div class="accordion-body" id="params-general">
                                <div class="row form-row">
                                    <div class="col-auto w-25">
                                        <label class="mb-0 align-self-center">Image Dimensions:</label>
                                    </div>
                                    <div class="col-sm">
                                        <label class="mb-0 lign-self-center">Scale (%):</label>
                                    </div>
                                    <input class="col-sm form-control" type="number" min="0" max="100" value="100"
                                        name="scale" id="scale" oninput="updateTime()" />
                                    <div class="col-sm"><label class="mb-0 align-self-center" for="xdim">X:</label>
                                    </div>
                                    <input class="col-sm form-control" type="number" min="1" max="256" value="256"
                                        name="xdim" id="xdim" oninput="" disabled />
                                    <div class="col-sm">
                                        <label class="mb-0 align-self-center" for="ydim">Y:</label>
                                    </div>
                                    <input class="col-sm form-control" type="number" min="1" max="256" value="256"
                                        name="ydim" id="ydim" oninput="" disabled />
                                    <div class="col-sm">
                                        <label class="mb-0 align-self-center" for="zdim">Z:</label>
                                    </div>
                                    <input class="col-sm form-control" type="number" min="1" max="256" value="256"
                                        name="zdim" id="zdim" oninput="" disabled />
                                </div>
                                <div class="row form-row">
                                    <div class="col-auto w-25">
                                        <label class="mb-0 align-self-center">Image Spacing:</label>
                                    </div>
                                    <div class="col-sm"><label class="mb-0 align-self-center" for="xsize">X:</label>
                                    </div>
                                    <input class="col-sm form-control" type="number" name="xsize" id="xsize" oninput=""
                                        disabled />
                                    <div class="col-sm">
                                        <label class="mb-0 align-self-center" for="ysize">Y:</label>
                                    </div>
                                    <input class="col-sm form-control" type="number" name="ysize" id="ysize" oninput=""
                                        disabled />
                                    <div class="col-sm">
                                        <label class="mb-0 align-self-center" for="zsize">Z:</label>
                                    </div>
                                    <input class="col-sm form-control" type="number" name="zsize" id="zsize" oninput=""
                                        disabled />
                                </div>
                                <!--<div class="row form-row">
                                    <div class="col-auto w-25">
                                        <label class="mb-0 align-self-center">Image Start:</label>
                                    </div>
                                    <div class="col-sm"><label class="mb-0 align-self-center">X:</label></div>
                                    <input class="col-sm form-control" type="number" min="1" max="256" value="0" name="xstart" id="xstart" oninput="updateTime()" />
                                    <div class="col-sm">
                                        <label class="mb-0 align-self-center">Y:</label>
                                    </div>
                                    <input class="col-sm form-control" type="number" min="1", max="256" value="0" name="ystart" id="ystart" oninput="updateTime()" />
                                    <div class="col-sm">
                                        <label class="mb-0 align-self-center">Z:</label>
                                    </div>
                                    <input class="col-sm form-control" type="number" min="1", max="256" value="0" name="zstart" id="zstart" oninput="updateTime()" />
                                </div>-->
                                <div class="row form-row">
                                    <div class="col-auto w-25">
                                        <label class="mb-0 align-self-center">Interpolation Mode:</label>
                                    </div>
                                    <select class="col-sm form-select" type="select" id="nearest" name="nearest"
                                        oninput="updateTime()">
                                        <option value="0" selected>Nearest Neigbhbour</option>
                                        <option value="1">Linear Interpolation, 8 Nearest Neighbours</option>
                                        <option value="2">Average</option>
                                    </select>
                                </div>
                                <div class="row form-row">
                                    <div class="col-auto w-25">
                                        <label class="mb-0 align-self-center">FFT:</label>
                                    </div>
                                    <select class="col-sm form-select" type="select" id="fft" name="fft"
                                        oninput="updateTime()">
                                        <option value="3d" selected>3D</option>
                                        <option value="2d">2D</option>
                                    </select>
                                </div>
                                <div class="row form-row">
                                    <div class="col-auto w-25">
                                        <label class="mb-0 align-self-center">Computation Subsystem:</label>
                                    </div>
                                    <select class="col-sm form-select" type="select" id="compute" name="compute"
                                        oninput="updateTime()">
                                        <option value="WebASM" selected>WebASM (fast)</option>
                                        <option value="JS">JavaScript (slow)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <div class="accordion-header" id="acc-noise-head" onclick="toggleAccordion('noise')">
                            <button class="accordion-button collapsed" type="button">Noise</button>
                        </div>
                        <div class="accordion-collapse collapse" id="acc-noise-content">
                            <div class="accordion-body" id="params-noise">
                                <div class="row form-row">
                                    <div class="col-auto w-25">
                                        <label class="mb-0 align-self-center">Noise:</label>
                                    </div>
                                    <select class="col-sm form-select" type="select" id="img_noise_type"
                                        name="img_noise_type" oninput="updateTime()">
                                        <option value="0" selected>No Noise</option>
                                        <!--<option value="1">Gaussian Noise in Image Domain</option>-->
                                        <option value="2">Gaussian Noise in Frequency Domain</option>
                                    </select>
                                    <div class="col-auto ml-4">
                                        <label class="mb-0 align-self-center">Mean:</label>
                                    </div>
                                    <input class="col-sm form-control" type="number" value="0" name="img_noise_mean"
                                        id="img_noise_mean" oninput="updateTime()" />
                                    <div class="col-auto ml-4">
                                        <label class="mb-0 align-self-center">SD:</label>
                                    </div>
                                    <input class="col-sm form-control" type="number" min="0" value="10"
                                        name="img_noise_sigma" id="img_noise_sigma" oninput="updateTime()" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <div class="accordion-header" id="acc-kspace-head" onclick="toggleAccordion('kspace')">
                            <button class="accordion-button collapsed" type="button">K-Space Manipulation</button>
                        </div>
                        <div class="accordion-collapse collapse" id="acc-kspace-content">
                            <div class="accordion-body" id="params-kspace">
                                <div class="row form-row">
                                    <div class="col-sm">
                                        <label class="mb-0 align-self-center">Filtering mode:</label>
                                    </div>
                                    <select class="col-sm form-select" type="select" id="kspace_filter_mode"
                                        name="kspace_filter_mode" oninput="updateTime()">
                                        <option value="0" selected>Sample fully</option>
                                        <option value="1">Pseudo Random lines</option>
                                        <option value="2">Pseudo Random points</option>
                                        <option value="3">Regulary spaced lines</option>
                                        <option value="4">Random Lines</option>
                                        <option value="5">Random Points</option>
                                    </select>
                                    <div class="col-sm">
                                        <label class="mb-0 align-self-center">K-Space sampled %:</label>
                                    </div>
                                    <input class="col-sm form-control" type="number" min="0" max="100" value="50"
                                        name="kspace_filter_fraction" id="kspace_filter_fraction"
                                        oninput="updateTime()" />
                                </div>
                                <div class="row form-row">
                                    <div class="col-sm">
                                        <label class="mb-0 align-self-center">Drop lower % of frequency spectrum</label>
                                    </div>
                                    <input class="col-sm form-control" type="number" min="0" max="100" value="0"
                                        name="kspace_filter_fmin" id="kspace_filter_fmin" oninput="updateTime()" />
                                    <div class="col-sm">
                                        <label class="mb-0 align-self-center">Drop high % of frequency spectrum</label>
                                    </div>
                                    <input class="col-sm form-control" type="number" min="0" max="100" value="100"
                                        name="kspace_filter_fmax" id="kspace_filter_fmax" oninput="updateTime()" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <div class="accordion-header" id="acc-cs-head" onclick="toggleAccordion('cs')">
                            <button class="accordion-button collapsed" type="button">Compressed Sensing</button>
                        </div>
                        <div class="accordion-collapse collapse" id="acc-cs-content">
                            <div class="accordion-body" id="params-cs">
                                <div class="row form-row">
                                    <div class="col-auto w-25">
                                        <label class="mb-0 align-self-center">Compressed Sensing:</label>
                                    </div>
                                    <select class="col-sm form-select" type="select" id="cs" name="cs"
                                        oninput="updateTime()">
                                        <option value="0" selected>Disable</option>
                                        <option value="2">Enabled</option>
                                        <!--<option value="3">CS Enabled fast</option>-->
                                        <!--<option value="4">fft3 test</option>-->
                                    </select>
                                </div>
                                <div class="row form-row">
                                    <div class="col-auto w-25">
                                        <label class="mb-0 align-self-center">Compressed Sensing Parameters:</label>
                                    </div>
                                    <div class="col-sm">
                                        <label class="mb-0 align-self-center">Ninner:</label>
                                    </div>
                                    <input class="col-sm form-control" type="number" name="cs_ninner" id="cs_ninner"
                                        value="1" oninput="updateTime()" />
                                    <div class="col-sm">
                                        <label class="mb-0 align-self-center">Nreg:</label>
                                    </div>
                                    <input class="col-sm form-control" type="number" name="cs_nbreg" id="cs_nbreg"
                                        value="80" oninput="updateTime()" />
                                </div>
                                <div class="row form-row">
                                    <div class="col-auto w-25">
                                        <!--<label class="mb-0 align-self-center">Compressed Sensing Parameters:</label>-->
                                    </div>
                                    <div class="col-sm">
                                        <label class="mb-0 align-self-center">lambda 1:</label>
                                    </div>
                                    <input class="col-sm form-control" type="number" name="cs_lambda1" id="cs_lambda1"
                                        value="1" oninput="updateTime()" />
                                    <div class="col-sm">
                                        <label class="mb-0 align-self-center">lambda 2:</label>
                                    </div>
                                    <input class="col-sm form-control" type="number" name="cs_lambda2" id="cs_lambda2"
                                        value="0.001" oninput="updateTime()" />
                                    <div class="col-sm">
                                        <label class="mb-0 align-self-center">mu:</label>
                                    </div>
                                    <input class="col-sm form-control" type="number" name="cs_mu" id="cs_mu" value="1"
                                        oninput="updateTime()" />
                                    <div class="col-sm">
                                        <label class="mb-0 align-self-center">gam:</label>
                                    </div>
                                    <input class="col-sm form-control" type="number" name="cs_gam" id="cs_gam" value="1"
                                        oninput="updateTime()" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mt-2" onkeydown="sequenceParametersKeyDown(event)">
                <div class="col" id="sequence">
                    <div class="row">
                        <div class="col nav nav-tabs">
                            <div class="nav-link active" id="params-IR-tab" onclick="setSequence('IR')">Inversion
                                Recovery</div>
                            <div class="nav-link" id="params-SE-tab" onclick="setSequence('SE')">Spin Echo</div>
                            <div class="nav-link" id="params-bSSFP-tab" onclick="setSequence('bSSFP')">Balanced SSFP
                            </div>
                            <div class="nav-link" id="params-FISP-tab" onclick="setSequence('FISP')">FISP</div>
                            <div class="nav-link" id="params-PSIF-tab" onclick="setSequence('PSIF')">PSIF</div>
                            <div class="nav-link" id="params-SGRE-tab" onclick="setSequence('SGRE')">Spoiled GRE</div>
                            <div class="" style="flex-grow: 4"></div>
                            <div class="nav-link" id="params-Na-tab" onclick="setSequence('Na')">Natrium</div>
                            <div class="nav-link" id="params-SQ-tab" onclick="setSequence('SQ')">Na SQ</div>
                            <div class="nav-link" id="params-TQ-tab" onclick="setSequence('TQ')">Na TQ</div>
                            <div class="nav-link" id="params-TQSQR-tab" onclick="setSequence('TQSQR')">Na TQ/SQ</div>
                        </div>
                    </div>
                    <div class="row border py-2 tab-content" id="params">
                        <div class="col tab-pane active" id="params-IR">
                            <div class="row form-row">
                                <div class="col-auto w-25">
                                    <label class="mb-0 align-self-center">TI:</label>
                                </div>
                                <input class="col-sm form-control" type="number" value="420" name="ti" id="ir_ti"
                                    oninput="updateTime()" />
                            </div>
                            <div class="row form-row">
                                <div class="col-auto w-25">
                                    <label class="mb-0 align-self-center">TE:</label>
                                </div>
                                <input class="col-sm form-control" type="number" value="23" name="te" id="ir_te"
                                    oninput="updateTime()" />
                            </div>
                            <div class="row form-row">
                                <div class="col-auto w-25">
                                    <label class="mb-0 align-self-center">TR:</label>
                                </div>
                                <input class="col-sm form-control" type="number" value="6666" name="tr" id="ir_tr"
                                    oninput="updateTime()" />
                            </div>
                            <div class="row form-row">
                                <div class="col-auto w-25">
                                    <label class="mb-0 align-self-center">Total Measuring Time:</label>
                                </div>
                                <p class="col-sm form-control mb-0" id="ir_time"></p>
                            </div>
                        </div>
                        <div class="col tab-pane" id="params-SE">
                            <div class="row form-row">
                                <div class="col-auto w-25">
                                    <label class="mb-0 align-self-center">TE:</label>
                                </div>
                                <input class="col-sm form-control" type="number" value="13" name="te" id="se_te"
                                    oninput="updateSETime()" />
                            </div>
                            <div class="row form-row">
                                <div class="col-auto w-25">
                                    <label class="mb-0 align-self-center">TR:</label>
                                </div>
                                <input class="col-sm form-control" type="number" value="666" name="tr" id="se_tr"
                                    oninput="updateSETime()" />
                            </div>
                            <div class="row form-row">
                                <div class="col-auto w-25">
                                    <label class="mb-0 align-self-center">Total Measuring Time:</label>
                                </div>
                                <p class="col-sm form-control mb-0" id="se_time"></p>
                            </div>
                        </div>
                        <div class="col tab-pane" id="params-bSSFP">
                            <div class="row form-row">
                                <div class="col-auto w-25">
                                    <label class="mb-0 align-self-center">TE:</label>
                                </div>
                                <input class="col-sm form-control" type="number" value="42" name="te" id="bssfp_te"
                                    oninput="updateBalancedSSFPTime()" />
                            </div>
                            <div class="row form-row">
                                <div class="col-auto w-25">
                                    <label class="mb-0 align-self-center">TR:</label>
                                </div>
                                <input class="col-sm form-control" type="number" value="84" name="tr" id="bssfp_tr"
                                    disabled />
                            </div>
                            <div class="row form-row">
                                <div class="col-auto w-25">
                                    <label class="mb-0 align-self-center">FA:</label>
                                </div>
                                <input class="col-sm form-control" type="number" value="23" min="-180" max="180"
                                    name="fa" id="bssfp_fa" oninput="updateBalancedSSFPTime()" />
                            </div>
                            <div class="row form-row">
                                <div class="col-auto w-25">
                                    <label class="mb-0 align-self-center">Total Measuring Time:</label>
                                </div>
                                <p class="col-sm form-control mb-0" id="bssfp_time"></p>
                            </div>
                        </div>
                        <div class="col tab-pane" id="params-FISP">
                            <div class="row form-row">
                                <div class="col-auto w-25">
                                    <label class="mb-0 align-self-center">TE:</label>
                                </div>
                                <input class="col-sm form-control" type="number" value="15" name="te" id="fisp_te"
                                    oninput="updateFISPTime()" />
                            </div>
                            <div class="row form-row">
                                <div class="col-auto w-25">
                                    <label class="mb-0 align-self-center">TR:</label>
                                </div>
                                <input class="col-sm form-control" type="number" value="50" name="tr" id="fisp_tr"
                                    oninput="updateFISPTime()" />
                            </div>
                            <div class="row form-row">
                                <div class="col-auto w-25">
                                    <label class="mb-0 align-self-center">FA:</label>
                                </div>
                                <input class="col-sm form-control" type="number" value="70" min="-180" max="180"
                                    name="fa" id="fisp_fa" oninput="updateFISPTime()" />
                            </div>
                            <div class="row form-row">
                                <div class="col-auto w-25">
                                    <label class="mb-0 align-self-center">Total Measuring Time:</label>
                                </div>
                                <p class="col-sm form-control mb-0" id="fisp_time"></p>
                            </div>
                        </div>
                        <div class="col tab-pane" id="params-PSIF">
                            <div class="row form-row">
                                <div class="col-auto w-25">
                                    <label class="mb-0 align-self-center">TE:</label>
                                </div>
                                <input class="col-sm form-control" type="number" value="42" name="te" id="psif_te"
                                    oninput="updatePSIFTime()" />
                            </div>
                            <div class="row form-row">
                                <div class="col-auto w-25">
                                    <label class="mb-0 align-self-center">TR:</label>
                                </div>
                                <input class="col-sm form-control" type="number" value="84" name="tr" id="psif_tr"
                                    oninput="updatePSIFTime()" />
                            </div>
                            <div class="row form-row">
                                <div class="col-auto w-25">
                                    <label class="mb-0 align-self-center">FA:</label>
                                </div>
                                <input class="col-sm form-control" type="number" value="23" min="-180" max="180"
                                    name="fa" id="psif_fa" oninput="updatePSIFTime()" />
                            </div>
                            <div class="row form-row">
                                <div class="col-auto w-25">
                                    <label class="mb-0 align-self-center">Total Measuring Time:</label>
                                </div>
                                <p class="col-sm form-control mb-0" id="psif_time"></p>
                            </div>
                        </div>
                        <div class="col tab-pane" id="params-SGRE">
                            <div class="row form-row">
                                <div class="col-auto w-25">
                                    <label class="mb-0 align-self-center">TE:</label>
                                </div>
                                <input class="col-sm form-control" type="number" value="42" name="te" id="sgre_te"
                                    oninput="updateSGRETime()" />
                            </div>
                            <div class="row form-row">
                                <div class="col-auto w-25">
                                    <label class="mb-0 align-self-center">TR:</label>
                                </div>
                                <input class="col-sm form-control" type="number" value="666" name="tr" id="sgre_tr"
                                    oninput="updateSGRETime()" />
                            </div>
                            <div class="row form-row">
                                <div class="col-auto w-25">
                                    <label class="mb-0 align-self-center">FA:</label>
                                </div>
                                <input class="col-sm form-control" type="number" value="23" min="-180" max="180"
                                    name="fa" id="sgre_fa" oninput="updateSGRETime()" />
                            </div>
                            <div class="row form-row">
                                <div class="col-auto w-25">
                                    <label class="mb-0 align-self-center">Total Measuring Time:</label>
                                </div>
                                <p class="col-sm form-control mb-0" id="sgre_time"></p>
                            </div>
                        </div>
                        <div class="col tab-pane" id="params-Na">
                            <div class="row form-row">
                                <div class="col-auto w-25">
                                    <label class="mb-0 align-self-center">TE:</label>
                                </div>
                                <input class="col-sm form-control" type="number" value="1" name="te" id="na_te"
                                    oninput="updateNaTime()" />
                            </div>
                            <div class="row form-row">
                                <div class="col-auto w-25">
                                    <label class="mb-0 align-self-center">TR:</label>
                                </div>
                                <input class="col-sm form-control" type="number" value="666" name="tr" id="na_tr"
                                    oninput="updateNaTime()" />
                            </div>
                            <div class="row form-row">
                                <div class="col-auto w-25">
                                    <label class="mb-0 align-self-center">Total Measuring Time:</label>
                                </div>
                                <p class="col-sm form-control mb-0" id="na_time"></p>
                            </div>
                        </div>
                        <div class="col tab-pane" id="params-SQ">
                            <div class="row form-row">
                                <div class="col-auto w-25">
                                    <label class="mb-0 align-self-center">FA (Default 90):</label>
                                </div>
                                <input class="col-sm form-control" type="number" value="90" name="fa" id="sq_fa"
                                    oninput="updateSQTime()" />
                            </div>
                            <div class="row form-row">
                                <div class="col-auto w-25">
                                    <label class="mb-0 align-self-center">τ1 (Default: 10):</label>
                                </div>
                                <input class="col-sm form-control" type="number" value="10" name="tau1" id="sq_tau1"
                                    oninput="updateSQTime()" />
                            </div>
                            <div class="row form-row">
                                <div class="col-auto w-25">
                                    <label class="mb-0 align-self-center">TE Start:</label>
                                </div>
                                <input class="col-sm form-control" type="number" value="1" name="te_start"
                                    id="sq_te_start" oninput="updateSQTime()" />
                            </div>
                            <div class="row form-row">
                                <div class="col-auto w-25">
                                    <label class="mb-0 align-self-center">TE End:</label>
                                </div>
                                <input class="col-sm form-control" type="number" value="16" name="te_end" id="sq_te_end"
                                    oninput="updateSQTime()" />
                            </div>
                            <div class="row form-row">
                                <div class="col-auto w-25">
                                    <label class="mb-0 align-self-center">TE Step:</label>
                                </div>
                                <input class="col-sm form-control" type="number" value="3" name="te_step"
                                    id="sq_te_step" oninput="updateSQTime()" />
                            </div>
                            <div class="row form-row">
                                <div class="col-auto w-25">
                                    <label class="mb-0 align-self-center">TEs:</label>
                                </div>
                                <p class="col-sm form-control mb-0" id="sq_te"></p>
                            </div>
                        </div>
                        <div class="col tab-pane" id="params-TQ">
                            <div class="row form-row">
                                <div class="col-auto w-25">
                                    <label class="mb-0 align-self-center">FA (Default 90):</label>
                                </div>
                                <input class="col-sm form-control" type="number" value="90" name="fa" id="tq_fa"
                                    oninput="updateTQTime()" />
                            </div>
                            <div class="row form-row">
                                <div class="col-auto w-25">
                                    <label class="mb-0 align-self-center">τ1 (Default: 10):</label>
                                </div>
                                <input class="col-sm form-control" type="number" value="10" name="tau1" id="tq_tau1"
                                    oninput="updateTQTime()" />
                            </div>
                            <div class="row form-row">
                                <div class="col-auto w-25">
                                    <label class="mb-0 align-self-center">τ2 (Default: 0.1):</label>
                                </div>
                                <input class="col-sm form-control" type="number" value="0.1" name="tau2" id="tq_tau2"
                                    oninput="updateTQTime()" />
                            </div>
                            <div class="row form-row">
                                <div class="col-auto w-25">
                                    <label class="mb-0 align-self-center">TE Start:</label>
                                </div>
                                <input class="col-sm form-control" type="number" value="1" name="te_start"
                                    id="tq_te_start" oninput="updateTQTime()" />
                            </div>
                            <div class="row form-row">
                                <div class="col-auto w-25">
                                    <label class="mb-0 align-self-center">TE End:</label>
                                </div>
                                <input class="col-sm form-control" type="number" value="16" name="te_end" id="tq_te_end"
                                    oninput="updateTQTime()" />
                            </div>
                            <div class="row form-row">
                                <div class="col-auto w-25">
                                    <label class="mb-0 align-self-center">TE Step:</label>
                                </div>
                                <input class="col-sm form-control" type="number" value="3" name="te_step"
                                    id="tq_te_step" oninput="updateTQTime()" />
                            </div>
                            <div class="row form-row">
                                <div class="col-auto w-25">
                                    <label class="mb-0 align-self-center">TEs:</label>
                                </div>
                                <p class="col-sm form-control mb-0" id="tq_te"></p>
                            </div>
                        </div>
                        <div class="col tab-pane" id="params-TQSQR">
                        </div>
                    </div>
                </div>
            </div>
            <div class="row m-2">
                <input type="button" class="col btn-primary" onclick="startScan()" value="Start Scan"
                    id="sequence_start" />
            </div>

            <div class="row">
                <!--<div class="col form-check form-switch">
                    <input type="checkbox" class="form-check-input" name="kspace" id="kspace_visible"
                        onchange="toggleImg()" checked />
                    <label class="form-check-label" for="kspace_visible">Show k-Space</label>
                </div>-->
                <!--<div class="col">
                <input type="number" class="ps-0 pe-0 form-control form-control-range" min="1"
                            name="kspacemult" id="kspacemult" value="20" onchange="displayAndWindow3DImage();" />
                </div>-->
                <div class="col form-check form-switch">
                    <input type="checkbox" class="form-check-input" name="pre" id="pre_visible" onchange="toggleImg()"
                        checked />
                    <label class="form-check-label" for="pre_visible">Show previous image</label>
                </div>
                <div class="col form-check form-switch">
                    <input type="checkbox" class="form-check-input" name="cur" id="cur_visible" onchange="toggleImg()"
                        checked />
                    <label class="form-check-label" for="cur_visible">Show current image</label>
                </div>
                <div class="col form-check form-switch">
                    <input type="checkbox" class="form-check-input" name="cs" id="cs_visible" onchange="toggleImg()"
                        checked />
                    <label class="form-check-label" for="cs_visible">Show compressed sensing image</label>
                </div>
                <div class="col form-check form-switch">
                    <input type="checkbox" class="form-check-input" name="crosshair" id="crosshair_visible" onchange="displayAndWindow3DImage()"
                        checked />
                    <label class="form-check-label" for="crosshair_visible">Show crosshair</label>
                </div>
                <div class="col form-check form-switch">
                    <input type="checkbox" class="form-check-input" name="kspace" id="kspace_visible" onchange="toggleImg()"
                        checked />
                    <label class="form-check-label" for="kspace_visible">Show k-Space</label>
                </div>
            </div>
            <!--<div class="row">
                <div class="col form-check form-switch">
                    <input type="checkbox" class="form-check-input" name="cor" id="cor_visible" onchange="toggleImg()"
                        checked />
                    <label class="form-check-label" for="cor_visible">Show coronal slice</label>
                </div>
                <div class="col form-check form-switch">
                    <input type="checkbox" class="form-check-input" name="sag" id="sag_visible" onchange="toggleImg()"
                        checked />
                    <label class="form-check-label" for="sag_visible">Show sagittal slice</label>
                </div>
                <div class="col form-check form-switch">
                    <input type="checkbox" class="form-check-input" name="tra" id="tra_visible" onchange="toggleImg()"
                        checked />
                    <label class="form-check-label" for="tra_visible">Show transversal slice</label>
                </div>
            </div>-->

            <div class="row d-flex justify-content-center hidden" id="scanningSpinner">
                <div class="spinner-border" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
            <div class="progress hidden">
                <div class="progress-bar" id="cs_progress" role="progressbar" aria-valuenow="0" aria-valuemin="0"
                    aria-valuemax="100"></div>
            </div>

            <div class="row pt-3 hidden align-items-start" id="result">
                <div class="col hidden" id="pre_image">
                    <div class="row g-0">
                        <div class="col">
                            <div class="h-100 w-100 d-flex border" style="background-color: black; border-color: red !important;">
                                <canvas class="img-result w-100 my-auto" onwheel="scrollResult(event, 'tra')"
                                    onmousedown="startWindowing('pre')" onmouseup="endWindowing('pre')"
                                    onmouseout="endWindowing('pre')" onmousemove="windowResult(event, 'pre')"
                                    id="pre_traResult"></canvas>
                            </div>
                        </div>
                        <div class="col">
                            <div class="h-100 w-100 d-flex border" style="background-color: black; border-color: green !important;">
                                <canvas class="img-result w-100 my-auto" onwheel="scrollResult(event, 'sag')"
                                    onmousedown="startWindowing('pre')" onmouseup="endWindowing('pre')"
                                    onmouseout="endWindowing('pre')" onmousemove="windowResult(event, 'pre')"
                                    id="pre_sagResult"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="row g-0">
                        <div class="col">
                            <div class="h-100 w-100 d-flex border" style="background-color: black; border-color: blue !important;">
                                <canvas class="img-result w-100 my-auto" onwheel="scrollResult(event, 'cor')"
                                    onmousedown="startWindowing('pre')" onmouseup="endWindowing('pre')"
                                    onmouseout="endWindowing('pre')" onmousemove="windowResult(event, 'pre')"
                                    id="pre_corResult"></canvas>
                            </div>
                        </div>
                        <div class="col">
                            <div class="h-100 w-100 d-flex border" style="background-color: black;">
                                <canvas class="img-result w-100 my-auto" onwheel="scrollResult(event, '3d')"
                                    onmousedown="startRotation(event, 'pre')" onmouseup="endRotation('pre')"
                                    onmouseout="endRotation('pre')" onmousemove="rotateResult(event, 'pre')"
                                    id="pre_3dResult"></canvas>
                            </div>
                        </div>
                        <div class="col hidden">
                            <div class="h-100 w-100 d-flex border" style="background-color: black;">
                                <canvas class="img-result w-100 my-auto" onwheel="scrollResult(event, 'tra')"
                                    onmousedown="startWindowing('pre')" onmouseup="endWindowing('pre')"
                                    onmouseout="endWindowing('pre')" onmousemove="windowResult(event, 'pre')"
                                    id="pre_kResult"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="row" id="pre_windowing">
                        <div class="col">
                            <label for="ti">Window Center: </label>
                            <input type="number" class="ps-0 pe-0 form-control form-control-range" name="pre_wc"
                                id="pre_wc" min="0" max="4096" value="2048"
                                onchange="displayAndWindow3DImage('pre');" />
                        </div>
                        <div class="col">
                            <label for="tr">Window Width:</label>
                            <input type="number" class="ps-0 pe-0 form-control form-control-range" name="pre_ww"
                                id="pre_ww" min="0" max="4096" value="4096"
                                onchange="displayAndWindow3DImage('pre');" />
                        </div>
                        <div class="col">
                            <input type="button" class="btn-secondary align-self-center" value="Auto Window"
                                onclick="autoWindow('pre')" />
                        </div>
                    </div>
                    <div class="row my-2 colorBarContainer" id="pre_colorBarContainer">
                        <canvas class="colorBar" id="pre_colorBar"></canvas>
                    </div>
                    <div class="row my-2" id="pre_other">
                        <div class="col">
                            <label for="pre_kspacemult">KSpace Multiplier</label>
                            <input type="number" class="ps-0 pe-0 form-control form-control-range" min="1"
                                name="pre_kspacemult" id="pre_kspacemult" value="20"
                                onchange="displayAndWindow3DImage();" />
                        </div>
                        <div class="col">
                            <label for="pre_traslice">Transversal Slice:</label>
                            <input type="range" class="ps-0 pe-0 form-control form-control-range" min="0" max="zdim"
                                name="pre_traslice" id="pre_traslice" value="100"
                                onchange="displayAndWindow3DImage();" />
                        </div>
                        <div class="col">
                            <label for="pre_sagslice">Sagittal Slice:</label>
                            <input type="range" class="ps-0 pe-0 form-control form-control-range" min="0" max="zdim"
                                name="pre_sagslice" id="pre_sagslice" value="100"
                                onchange="displayAndWindow3DImage();" />
                        </div>
                        <div class="col">
                            <label for="pre_corslice">Coronal Slice:</label>
                            <input type="range" class="ps-0 pe-0 form-control form-control-range" min="0" max="zdim"
                                name="pre_corslice" id="pre_corslice" value="100"
                                onchange="displayAndWindow3DImage();" />
                        </div>
                    </div>
                </div>
                <div class="col" id="cur_image">
                    <div class="row g-0">
                        <div class="col">
                            <div class="border h-100 w-100 d-flex" style="background-color: black; border-color: red !important;">
                                <canvas class="img-result w-100 my-auto" onwheel="scrollResult(event, 'tra')"
                                    onmousedown="startWindowing('cur')" onmouseup="endWindowing('cur')"
                                    onmouseout="endWindowing('cur')" onmousemove="windowResult(event, 'cur')"
                                    id="cur_traResult"></canvas>
                            </div>
                        </div>
                        <div class="col">
                            <div class="border h-100 w-100 d-flex" style="background-color: black; border-color: green !important;">
                                <canvas class="img-result w-100 my-auto" onwheel="scrollResult(event, 'sag')"
                                    onmousedown="startWindowing('cur')" onmouseup="endWindowing('cur')"
                                    onmouseout="endWindowing('cur')" onmousemove="windowResult(event, 'cur')"
                                    id="cur_sagResult"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="row g-0">
                        <div class="col">
                            <div class="border h-100 w-100 d-flex" style="background-color: black; border-color: blue !important;">
                                <canvas class="img-result w-100 my-auto" onwheel="scrollResult(event, 'cor')"
                                    onmousedown="startWindowing('cur')" onmouseup="endWindowing('cur')"
                                    onmouseout="endWindowing('cur')" onmousemove="windowResult(event, 'cur')"
                                    id="cur_corResult"></canvas>
                            </div>
                        </div>
                        <div class="col">
                            <div class="h-100 w-100 d-flex border" style="background-color: black;">
                                <canvas class="img-result w-100 my-auto" onwheel="scrollResult(event, '3d')"
                                    onmousedown="startRotation(event, 'cur')" onmouseup="endRotation('cur')"
                                    onmouseout="endRotation('cur')" onmousemove="rotateResult(event, 'cur')"
                                    id="cur_3dResult"></canvas>
                            </div>
                        </div>
                        <div class="hidden col">
                            <div class="border h-100 w-100 d-flex" style="background-color: black;">
                                <canvas class="img-result w-100 my-auto" onwheel="scrollResult(event, 'tra')"
                                    onmousedown="startWindowing('cur')" onmouseup="endWindowing('cur')"
                                    onmouseout="endWindowing('cur')" onmousemove="windowResult(event, 'cur')"
                                    id="cur_kResult"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="row" id="cur_windowing">
                        <div class="col">
                            <label for="ti">Window Center: </label>
                            <input type="number" class="ps-0 pe-0 form-control form-control-range" name="cur_wc"
                                id="cur_wc" min="0" max="4096" value="2048"
                                onchange="displayAndWindow3DImage('cur');" />
                        </div>
                        <div class="col">
                            <label for="tr">Window Width:</label>
                            <input type="number" class="ps-0 pe-0 form-control form-control-range" name="cur_ww"
                                id="cur_ww" min="0" max="4096" value="4096"
                                onchange="displayAndWindow3DImage('cur');" />
                        </div>
                        <div class="col">
                            <input type="button" class="btn-secondary align-self-center" value="Auto Window"
                                onclick="autoWindow('cur')" />
                        </div>
                    </div>
                    <div class="row my-2 colorBarContainer" id="cur_colorBarContainer">
                        <canvas class="colorBar" id="cur_colorBar"></canvas>
                    </div>
                    <div class="row my-2" id="cur_other">
                        <div class="col">
                            <label for="cur_kspacemult">KSpace Multiplier</label>
                            <input type="number" class="ps-0 pe-0 form-control form-control-range" min="1"
                                name="cur_kspacemult" id="cur_kspacemult" value="20"
                                onchange="displayAndWindow3DImage();" />
                        </div>
                        <div class="col">
                            <label for="cur_traslice">Transversal Slice:</label>
                            <input type="range" class="ps-0 pe-0 form-control form-control-range" min="0" max="zdim"
                                name="cur_traslice" id="cur_traslice" value="100"
                                onchange="displayAndWindow3DImage();" />
                        </div>
                        <div class="col">
                            <label for="cur_sagslice">Sagittal Slice:</label>
                            <input type="range" class="ps-0 pe-0 form-control form-control-range" min="0" max="zdim"
                                name="cur_sagslice" id="cur_sagslice" value="100"
                                onchange="displayAndWindow3DImage();" />
                        </div>
                        <div class="col">
                            <label for="cur_corslice">Coronal Slice:</label>
                            <input type="range" class="ps-0 pe-0 form-control form-control-range" min="0" max="zdim"
                                name="cur_corslice" id="cur_corslice" value="100"
                                onchange="displayAndWindow3DImage();" />
                        </div>
                    </div>
                </div>
                <div class="col hidden" id="cs_image">
                    <div class="row g-0">
                        <div class="col">
                            <div class="border h-100 w-100 d-flex" style="background-color: black; border-color: red !important;">
                                <canvas class="img-result w-100 my-auto" onwheel="scrollResult(event, 'tra')"
                                    onmousedown="startWindowing('cs')" onmouseup="endWindowing('cs')"
                                    onmouseout="endWindowing('cs')" onmousemove="windowResult(event, 'cs')"
                                    id="cs_traResult"></canvas>
                            </div>
                        </div>
                        <div class="col">
                            <div class="border h-100 w-100 d-flex" style="background-color: black; border-color: green !important;">
                                <canvas class="img-result w-100 my-auto" onwheel="scrollResult(event, 'sag')"
                                    onmousedown="startWindowing('cs')" onmouseup="endWindowing('cs')"
                                    onmouseout="endWindowing('cs')" onmousemove="windowResult(event, 'cs')"
                                    id="cs_sagResult"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="row g-0">
                        <div class="col">
                            <div class="border h-100 w-100 d-flex" style="background-color: black; border-color: blue !important;">
                                <canvas class="img-result w-100 my-auto" onwheel="scrollResult(event, 'cor')"
                                    onmousedown="startWindowing('cs')" onmouseup="endWindowing('cs')"
                                    onmouseout="endWindowing('cs')" onmousemove="windowResult(event, 'cs')"
                                    id="cs_corResult"></canvas>
                            </div>
                        </div>
                        <div class="col">
                            <div class="h-100 w-100 d-flex border" style="background-color: black;">
                                <canvas class="img-result w-100 my-auto" onwheel="scrollResult(event, '3d')"
                                    onmousedown="startRotation(event, 'cs')" onmouseup="endRotation('cs')"
                                    onmouseout="endRotation('cs')" onmousemove="rotateResult(event, 'cs')"
                                    id="cs_3dResult"></canvas>
                            </div>
                        </div>
                        <div class="hidden col">
                            <div class="border h-100 w-100 d-flex" style="background-color: black;">
                                <canvas class="img-result w-100 my-auto" onwheel="scrollResult(event, 'tra')"
                                    onmousedown="startWindowing('cs')" onmouseup="endWindowing('cs')"
                                    onmouseout="endWindowing('cs')" onmousemove="windowResult(event, 'cs')"
                                    id="cs_kResult"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="row" id="cs_windowing">
                        <div class="col">
                            <label for="ti">Window Center: </label>
                            <input type="number" class="ps-0 pe-0 form-control form-control-range" name="cs_wc"
                                id="cs_wc" min="0" max="4096" value="2048" onchange="displayAndWindow3DImage('cs');" />
                        </div>
                        <div class="col">
                            <label for="tr">Window Width:</label>
                            <input type="number" class="ps-0 pe-0 form-control form-control-range" name="cs_ww"
                                id="cs_ww" min="0" max="4096" value="4096" onchange="displayAndWindow3DImage('cs');" />
                        </div>
                        <div class="col">
                            <input type="button" class="btn-secondary align-self-center" value="Auto Window"
                                onclick="autoWindow('cs')" />
                        </div>
                    </div>
                    <div class="row my-2 colorBarContainer" id="cs_colorBarContainer">
                        <canvas class="colorBar" id="cs_colorBar"></canvas>
                    </div>
                    <div class="row my-2" id="cs_other">
                        <div class="col">
                            <label for="cs_kspacemult">KSpace Multiplier</label>
                            <input type="number" class="ps-0 pe-0 form-control form-control-range" min="1"
                                name="cs_kspacemult" id="cs_kspacemult" value="20"
                                onchange="displayAndWindow3DImage();" />
                        </div>
                        <div class="col">
                            <label for="cs_traslice">Transversal Slice:</label>
                            <input type="range" class="ps-0 pe-0 form-control form-control-range" min="0" max="zdim"
                                name="cs_traslice" id="cs_traslice" value="100" onchange="displayAndWindow3DImage();" />
                        </div>
                        <div class="col">
                            <label for="cs_sagslice">Sagittal Slice:</label>
                            <input type="range" class="ps-0 pe-0 form-control form-control-range" min="0" max="zdim"
                                name="cs_sagslice" id="cs_sagslice" value="100" onchange="displayAndWindow3DImage();" />
                        </div>
                        <div class="col">
                            <label for="cs_corslice">Coronal Slice:</label>
                            <input type="range" class="ps-0 pe-0 form-control form-control-range" min="0" max="zdim"
                                name="cs_corslice" id="cs_corslice" value="100" onchange="displayAndWindow3DImage();" />
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

</body>

</html>